<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI ì„±ê²© ìœ í˜• í…ŒìŠ¤íŠ¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', sans-serif;
        }
        .navbar {
            background-color: rgba(0,0,0,0.1) !important;
        }
        .test-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .question-card {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            color: white;
        }
        .progress-bar-custom {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .answer-option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .answer-option:hover {
            background: #e9ecef;
            border-color: #007bff;
        }
        .answer-option.selected {
            background: #e3f2fd;
            border-color: #007bff;
            color: #007bff;
            font-weight: 500;
        }
        .header-title {
            color: white;
            text-align: center;
            margin-bottom: 2rem;
        }
        .question-number {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 2rem;
        }
        .modal-custom {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-custom.show {
            display: flex;
        }
        .modal-content-custom {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-brain me-2"></i>MBTI ë¶„ì„
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">í™ˆ</a></li>
                    <li class="nav-item"><a class="nav-link active" href="test.html">í…ŒìŠ¤íŠ¸</a></li>
                    <li class="nav-item"><a class="nav-link" href="career-test.html">ì§„ë¡œ íƒìƒ‰</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">ë¶„ì„ ë„êµ¬</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="type-search.html">ì„±ê²©ìœ í˜• ê²€ìƒ‰ê¸°</a></li>
                            <li><a class="dropdown-item" href="mbti-calculator.html">MBTI ì ìˆ˜ ê³„ì‚°ê¸°</a></li>
                            <li><a class="dropdown-item" href="type-comparison.html">ìœ í˜• ë¹„êµ ë„êµ¬</a></li>
                            <li><a class="dropdown-item" href="text-counter.html">ê¸€ììˆ˜ ì„¸ê¸°</a></li>
                            <li><a class="dropdown-item" href="quick-personality.html">ë¹ ë¥¸ ì„±ê²© ë¶„ì„</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="about.html">MBTIë€?</a>
                    <li class="nav-item"><a class="nav-link" href="github-settings.html">
                        <i class="fab fa-github me-1"></i>GitHub ì„¤ì •
                    </a></li></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="test-container">
        <!-- Header -->
        <div class="header-title">
            <h1>MBTI ì„±ê²© ìœ í˜• í…ŒìŠ¤íŠ¸</h1>
            <p class="lead">8ê°œì˜ ê°„ë‹¨í•œ ì§ˆë¬¸ìœ¼ë¡œ ë‹¹ì‹ ì˜ ì„±ê²© ìœ í˜•ì„ ì•Œì•„ë³´ì„¸ìš”</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="d-flex justify-content-between align-items-center">
                <span>ë¬¸í•­ <span id="currentQuestion">1</span> / <span id="totalQuestions">8</span></span>
                <span id="progressPercentage">12.5%</span>
            </div>
            <div class="progress-bar-custom">
                <div class="progress-fill" id="progressFill" style="width: 12.5%"></div>
            </div>
        </div>

        <!-- Question Card -->
        <div class="question-card">
            <div class="question-number">ë¬¸í•­ <span id="questionNumber">1</span></div>
            <div class="question-text" id="questionText">í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</div>
            <div id="answerOptions"></div>
            <div class="text-center mt-4">
                <button id="startTestBtn" class="btn btn-success btn-lg">
                    <i class="fas fa-play"></i> í…ŒìŠ¤íŠ¸ ì‹œì‘
                </button>
                <button id="nextBtn" class="btn btn-primary btn-lg" style="display: none;" disabled>
                    ë‹¤ìŒ <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div class="modal-custom" id="completionModal">
        <div class="modal-content-custom">
            <h2 class="mb-3">í…ŒìŠ¤íŠ¸ ì™„ë£Œ!</h2>
            <p class="mb-3">ê²°ê³¼ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            <div class="spinner" id="loadingSpinner"></div>
            <button id="viewResultBtn" class="btn btn-primary btn-lg" style="display: none;">
                <i class="fas fa-chart-line"></i> ê²°ê³¼ ë³´ê¸°
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const questions = [
            {
                id: 1,
                text: "ìƒˆë¡œìš´ ì‚¬ëŒë“¤ê³¼ ë§Œë‚˜ëŠ” ìƒí™©ì—ì„œ ë‹¹ì‹ ì€?",
                options: [
                    { text: "ë¨¼ì € ë‹¤ê°€ê°€ì„œ ëŒ€í™”ë¥¼ ì‹œì‘í•œë‹¤", value: "E" },
                    { text: "ìƒëŒ€ë°©ì´ ë¨¼ì € ë§ì„ ê±¸ì–´ì£¼ê¸°ë¥¼ ê¸°ë‹¤ë¦°ë‹¤", value: "I" }
                ]
            },
            {
                id: 2,
                text: "ì •ë³´ë¥¼ ë°›ì•„ë“¤ì¼ ë•Œ ë‹¹ì‹ ì€ ì£¼ë¡œ?",
                options: [
                    { text: "êµ¬ì²´ì ì´ê³  ì‹¤ìš©ì ì¸ ì •ë³´ë¥¼ ì„ í˜¸í•œë‹¤", value: "S" },
                    { text: "ê°œë…ì ì´ê³  ì´ë¡ ì ì¸ ì •ë³´ë¥¼ ì„ í˜¸í•œë‹¤", value: "N" }
                ]
            },
            {
                id: 3,
                text: "ê²°ì •ì„ ë‚´ë¦´ ë•Œ ë‹¹ì‹ ì´ ë” ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²ƒì€?",
                options: [
                    { text: "ë…¼ë¦¬ì ì´ê³  ê°ê´€ì ì¸ ë¶„ì„", value: "T" },
                    { text: "ì‚¬ëŒë“¤ì˜ ê°ì •ê³¼ ê°€ì¹˜ê´€", value: "F" }
                ]
            },
            {
                id: 4,
                text: "ì¼ìƒìƒí™œì—ì„œ ë‹¹ì‹ ì€?",
                options: [
                    { text: "ê³„íšì„ ì„¸ìš°ê³  ì²´ê³„ì ìœ¼ë¡œ ìƒí™œí•œë‹¤", value: "J" },
                    { text: "ìƒí™©ì— ë”°ë¼ ìœ ì—°í•˜ê²Œ ëŒ€ì‘í•œë‹¤", value: "P" }
                ]
            },
            {
                id: 5,
                text: "íŒŒí‹°ë‚˜ ëª¨ì„ì—ì„œ ë‹¹ì‹ ì€?",
                options: [
                    { text: "ì—¬ëŸ¬ ì‚¬ëŒë“¤ê³¼ ë‹¤ì–‘í•œ ëŒ€í™”ë¥¼ ë‚˜ëˆˆë‹¤", value: "E" },
                    { text: "í•œë‘ ëª…ê³¼ ê¹Šì´ ìˆëŠ” ëŒ€í™”ë¥¼ ë‚˜ëˆˆë‹¤", value: "I" }
                ]
            },
            {
                id: 6,
                text: "ë¬¸ì œë¥¼ í•´ê²°í•  ë•Œ ë‹¹ì‹ ì€?",
                options: [
                    { text: "ê²½í—˜ê³¼ ì‚¬ì‹¤ì— ê¸°ë°˜í•´ì„œ í•´ê²°í•œë‹¤", value: "S" },
                    { text: "ì§ê°ê³¼ ì˜ê°ì— ì˜ì¡´í•´ì„œ í•´ê²°í•œë‹¤", value: "N" }
                ]
            },
            {
                id: 7,
                text: "ë¹„íŒì„ ë°›ì•˜ì„ ë•Œ ë‹¹ì‹ ì€?",
                options: [
                    { text: "ë‚´ìš©ì´ í•©ë¦¬ì ì¸ì§€ ë¶„ì„í•œë‹¤", value: "T" },
                    { text: "ê¸°ë¶„ì´ ìƒí•˜ê³  ê°ì •ì ìœ¼ë¡œ ë°˜ì‘í•œë‹¤", value: "F" }
                ]
            },
            {
                id: 8,
                text: "ì—¬í–‰ì„ ê³„íší•  ë•Œ ë‹¹ì‹ ì€?",
                options: [
                    { text: "ë¯¸ë¦¬ ìƒì„¸í•œ ì¼ì •ì„ ì§ ë‹¤", value: "J" },
                    { text: "ê·¸ë•Œê·¸ë•Œ ìƒí™©ì— ë§ì¶° ê²°ì •í•œë‹¤", value: "P" }
                ]
            }
        ];

        class MBTITest {
            constructor() {
                this.currentQuestion = 0;
                this.answers = {};
                this.scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
                this.init();
            }

            init() {
                this.bindEvents();
                this.showWelcomeScreen();
            }

            bindEvents() {
                document.getElementById('startTestBtn').addEventListener('click', () => this.startTest());
                document.getElementById('nextBtn').addEventListener('click', () => this.nextQuestion());
            }

            showWelcomeScreen() {
                document.getElementById('questionText').textContent = 
                    "MBTI ì„±ê²© ìœ í˜• í…ŒìŠ¤íŠ¸ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! 8ê°œì˜ ê°„ë‹¨í•œ ì§ˆë¬¸ìœ¼ë¡œ ë‹¹ì‹ ì˜ ì„±ê²© ìœ í˜•ì„ ì•Œì•„ë³´ì„¸ìš”.";
                document.getElementById('answerOptions').innerHTML = '';
            }

            startTest() {
                document.getElementById('startTestBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';
                this.showQuestion();
            }

            showQuestion() {
                if (this.currentQuestion >= questions.length) {
                    this.completeTest();
                    return;
                }

                const question = questions[this.currentQuestion];
                this.updateQuestionDisplay(question);
                this.updateProgress();
                this.updateNavigationButtons();
            }

            updateQuestionDisplay(question) {
                document.getElementById('questionNumber').textContent = this.currentQuestion + 1;
                document.getElementById('questionText').textContent = question.text;
                
                const answerOptions = document.getElementById('answerOptions');
                answerOptions.innerHTML = '';
                
                question.options.forEach((option) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'answer-option';
                    optionElement.textContent = option.text;
                    
                    const previousAnswer = this.answers[question.id];
                    if (previousAnswer && previousAnswer.value === option.value) {
                        optionElement.classList.add('selected');
                    }
                    
                    optionElement.addEventListener('click', () => {
                        this.selectAnswer(question, option, optionElement);
                    });
                    
                    answerOptions.appendChild(optionElement);
                });
            }

            selectAnswer(question, option, element) {
                document.querySelectorAll('.answer-option').forEach(opt => opt.classList.remove('selected'));
                element.classList.add('selected');
                
                this.answers[question.id] = {
                    value: option.value,
                    dimension: question.dimension
                };
                
                document.getElementById('nextBtn').disabled = false;
            }

            nextQuestion() {
                this.currentQuestion++;
                this.showQuestion();
            }

            updateProgress() {
                const progress = ((this.currentQuestion + 1) / questions.length) * 100;
                document.getElementById('currentQuestion').textContent = this.currentQuestion + 1;
                document.getElementById('totalQuestions').textContent = questions.length;
                document.getElementById('progressPercentage').textContent = `${Math.round(progress)}%`;
                document.getElementById('progressFill').style.width = `${progress}%`;
            }

            updateNavigationButtons() {
                const nextBtn = document.getElementById('nextBtn');
                const currentAnswer = this.answers[questions[this.currentQuestion].id];
                nextBtn.disabled = !currentAnswer;
                
                if (this.currentQuestion === questions.length - 1) {
                    nextBtn.innerHTML = 'ì™„ë£Œ <i class="fas fa-check"></i>';
                } else {
                    nextBtn.innerHTML = 'ë‹¤ìŒ <i class="fas fa-chevron-right"></i>';
                }
            }

            calculateScores() {
                this.scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
                Object.values(this.answers).forEach(answer => {
                    this.scores[answer.value]++;
                });
            }

            getMBTIType() {
                this.calculateScores();
                let type = '';
                type += this.scores.E >= this.scores.I ? 'E' : 'I';
                type += this.scores.S >= this.scores.N ? 'S' : 'N';
                type += this.scores.T >= this.scores.F ? 'T' : 'F';
                type += this.scores.J >= this.scores.P ? 'J' : 'P';
                return type;
            }

            completeTest() {
                const mbtiType = this.getMBTIType();
                document.getElementById('completionModal').classList.add('show');
                
                const testResult = {
                    type: mbtiType,
                    scores: this.scores,
                    answers: this.answers,
                    completedAt: new Date().toISOString()
                };
                
                localStorage.setItem('mbtiTestResult', JSON.stringify(testResult));

                setTimeout(() => {
                    document.getElementById('loadingSpinner').style.display = 'none';
                    const resultBtn = document.getElementById('viewResultBtn');
                    resultBtn.style.display = 'inline-block';
                    resultBtn.onclick = () => {
                        this.showResult(mbtiType, testResult);
                    };
                }, 2000);
            }

            showResult(mbtiType, testResult) {
                const modal = document.getElementById('completionModal');
                const modalContent = modal.querySelector('.modal-content-custom');
                
                modalContent.innerHTML = `
                    <h2 class="mb-3">ğŸ‰ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!</h2>
                    <div class="result-display">
                        <h3 class="text-primary">${mbtiType}</h3>
                        <p class="lead">ë‹¹ì‹ ì˜ MBTI ì„±ê²© ìœ í˜•ì…ë‹ˆë‹¤!</p>
                        
                        <div class="mt-4 d-flex gap-2 flex-wrap justify-content-center">
                            <button class="btn btn-primary" onclick="location.href='types/${mbtiType.toLowerCase()}.html'">
                                <i class="fas fa-info-circle me-2"></i>ìƒì„¸ ë¶„ì„ ë³´ê¸°
                            </button>
                            <button class="btn btn-success" onclick="shareResult()">
                                <i class="fas fa-share me-2"></i>ê²°ê³¼ ê³µìœ 
                            </button>
                            <button class="btn btn-secondary" onclick="saveToGitHub()">
                                <i class="fab fa-github me-2"></i>GitHubì— ì €ì¥
                            </button>
                            <button class="btn btn-outline-primary" onclick="location.reload()">
                                <i class="fas fa-redo me-2"></i>ë‹¤ì‹œ í…ŒìŠ¤íŠ¸
                            </button>
                        </div>
                        
                        <div id="saveStatus" class="mt-3"></div>
                    </div>
                `;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new MBTITest();
        });

        // GitHub ì—°ë™ í•¨ìˆ˜ë“¤
        async function saveToGitHub() {
            const saveStatus = document.getElementById('saveStatus');
            
            try {
                // GitHub API ì„¤ì • í™•ì¸
                const settings = localStorage.getItem('github_api_settings');
                if (!settings) {
                    saveStatus.innerHTML = `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            GitHub APIê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. 
                            <a href="github-settings.html" class="alert-link">ì„¤ì • í˜ì´ì§€</a>ì—ì„œ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.
                        </div>
                    `;
                    return;
                }

                saveStatus.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-spinner fa-spin me-2"></i>GitHubì— ì €ì¥ ì¤‘...
                    </div>
                `;

                const testResult = JSON.parse(localStorage.getItem('mbtiTestResult'));
                const githubSettings = JSON.parse(atob(settings));
                
                // GitHub Gist ìƒì„±
                const response = await fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${githubSettings.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        description: `MBTI í…ŒìŠ¤íŠ¸ ê²°ê³¼ - ${testResult.type}`,
                        public: false,
                        files: {
                            [`mbti-result-${testResult.type}-${new Date().toISOString().split('T')[0]}.md`]: {
                                content: `# MBTI í…ŒìŠ¤íŠ¸ ê²°ê³¼

## ë¶„ì„ ê²°ê³¼
- **ìœ í˜•**: ${testResult.type}
- **í…ŒìŠ¤íŠ¸ ë‚ ì§œ**: ${new Date(testResult.completedAt).toLocaleString('ko-KR')}

## ìƒì„¸ ì ìˆ˜
${Object.entries(testResult.scores).map(([key, value]) => `- ${key}: ${value}ì `).join('\n')}

## ë‹µë³€ ë‚´ì—­
${Object.entries(testResult.answers).map(([key, value]) => `**ë¬¸í•­ ${key}**: ${value.text || value.value}`).join('\n')}

---
*ì´ ê²°ê³¼ëŠ” MBTI ë¶„ì„ ì‚¬ì´íŠ¸ì—ì„œ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*
`
                            }
                        }
                    })
                });

                if (response.ok) {
                    const gist = await response.json();
                    saveStatus.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>
                            GitHubì— ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!
                            <a href="${gist.html_url}" target="_blank" class="alert-link ms-2">
                                <i class="fas fa-external-link-alt"></i> í™•ì¸í•˜ê¸°
                            </a>
                        </div>
                    `;
                } else {
                    throw new Error('GitHub ì €ì¥ ì‹¤íŒ¨');
                }
            } catch (error) {
                saveStatus.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-times-circle me-2"></i>
                        ì €ì¥ ì‹¤íŒ¨: ${error.message}
                    </div>
                `;
            }
        }

        function shareResult() {
            const testResult = JSON.parse(localStorage.getItem('mbtiTestResult'));
            const shareText = `MBTI í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${testResult.type}\n\në‚˜ì˜ ì„±ê²© ìœ í˜•ì„ ë°œê²¬í–ˆì–´ìš”! ë‹¹ì‹ ë„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.\n\n${window.location.origin}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'MBTI í…ŒìŠ¤íŠ¸ ê²°ê³¼',
                    text: shareText,
                    url: window.location.origin
                });
            } else {
                navigator.clipboard.writeText(shareText)
                    .then(() => alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))
                    .catch(() => alert('ê³µìœ  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'));
            }
        }
    </script>
</body>
</html>