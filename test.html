<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI 성격 유형 테스트</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', sans-serif;
        }
        .navbar {
            background-color: rgba(0,0,0,0.1) !important;
        }
        .test-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .question-card {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            color: white;
        }
        .progress-bar-custom {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .answer-option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .answer-option:hover {
            background: #e9ecef;
            border-color: #007bff;
        }
        .answer-option.selected {
            background: #e3f2fd;
            border-color: #007bff;
            color: #007bff;
            font-weight: 500;
        }
        .header-title {
            color: white;
            text-align: center;
            margin-bottom: 2rem;
        }
        .question-number {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 2rem;
        }
        .modal-custom {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-custom.show {
            display: flex;
        }
        .modal-content-custom {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-brain me-2"></i>MBTI 분석
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">홈</a></li>
                    <li class="nav-item"><a class="nav-link active" href="test.html">테스트</a></li>
                    <li class="nav-item"><a class="nav-link" href="career-test.html">진로 탐색</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">분석 도구</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="type-search.html">성격유형 검색기</a></li>
                            <li><a class="dropdown-item" href="mbti-calculator.html">MBTI 점수 계산기</a></li>
                            <li><a class="dropdown-item" href="type-comparison.html">유형 비교 도구</a></li>
                            <li><a class="dropdown-item" href="text-counter.html">글자수 세기</a></li>
                            <li><a class="dropdown-item" href="quick-personality.html">빠른 성격 분석</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="about.html">MBTI란?</a>
                    <li class="nav-item"><a class="nav-link" href="github-settings.html">
                        <i class="fab fa-github me-1"></i>GitHub 설정
                    </a></li></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="test-container">
        <!-- Header -->
        <div class="header-title">
            <h1>MBTI 성격 유형 테스트</h1>
            <p class="lead">8개의 간단한 질문으로 당신의 성격 유형을 알아보세요</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="d-flex justify-content-between align-items-center">
                <span>문항 <span id="currentQuestion">1</span> / <span id="totalQuestions">8</span></span>
                <span id="progressPercentage">12.5%</span>
            </div>
            <div class="progress-bar-custom">
                <div class="progress-fill" id="progressFill" style="width: 12.5%"></div>
            </div>
        </div>

        <!-- Question Card -->
        <div class="question-card">
            <div class="question-number">문항 <span id="questionNumber">1</span></div>
            <div class="question-text" id="questionText">테스트를 시작하려면 아래 버튼을 클릭하세요.</div>
            <div id="answerOptions"></div>
            <div class="text-center mt-4">
                <button id="startTestBtn" class="btn btn-success btn-lg">
                    <i class="fas fa-play"></i> 테스트 시작
                </button>
                <button id="nextBtn" class="btn btn-primary btn-lg" style="display: none;" disabled>
                    다음 <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div class="modal-custom" id="completionModal">
        <div class="modal-content-custom">
            <h2 class="mb-3">테스트 완료!</h2>
            <p class="mb-3">결과를 분석하고 있습니다...</p>
            <div class="spinner" id="loadingSpinner"></div>
            <button id="viewResultBtn" class="btn btn-primary btn-lg" style="display: none;">
                <i class="fas fa-chart-line"></i> 결과 보기
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const questions = [
            {
                id: 1,
                text: "새로운 사람들과 만나는 상황에서 당신은?",
                options: [
                    { text: "먼저 다가가서 대화를 시작한다", value: "E" },
                    { text: "상대방이 먼저 말을 걸어주기를 기다린다", value: "I" }
                ]
            },
            {
                id: 2,
                text: "정보를 받아들일 때 당신은 주로?",
                options: [
                    { text: "구체적이고 실용적인 정보를 선호한다", value: "S" },
                    { text: "개념적이고 이론적인 정보를 선호한다", value: "N" }
                ]
            },
            {
                id: 3,
                text: "결정을 내릴 때 당신이 더 중요하게 생각하는 것은?",
                options: [
                    { text: "논리적이고 객관적인 분석", value: "T" },
                    { text: "사람들의 감정과 가치관", value: "F" }
                ]
            },
            {
                id: 4,
                text: "일상생활에서 당신은?",
                options: [
                    { text: "계획을 세우고 체계적으로 생활한다", value: "J" },
                    { text: "상황에 따라 유연하게 대응한다", value: "P" }
                ]
            },
            {
                id: 5,
                text: "파티나 모임에서 당신은?",
                options: [
                    { text: "여러 사람들과 다양한 대화를 나눈다", value: "E" },
                    { text: "한두 명과 깊이 있는 대화를 나눈다", value: "I" }
                ]
            },
            {
                id: 6,
                text: "문제를 해결할 때 당신은?",
                options: [
                    { text: "경험과 사실에 기반해서 해결한다", value: "S" },
                    { text: "직감과 영감에 의존해서 해결한다", value: "N" }
                ]
            },
            {
                id: 7,
                text: "비판을 받았을 때 당신은?",
                options: [
                    { text: "내용이 합리적인지 분석한다", value: "T" },
                    { text: "기분이 상하고 감정적으로 반응한다", value: "F" }
                ]
            },
            {
                id: 8,
                text: "여행을 계획할 때 당신은?",
                options: [
                    { text: "미리 상세한 일정을 짠다", value: "J" },
                    { text: "그때그때 상황에 맞춰 결정한다", value: "P" }
                ]
            }
        ];

        class MBTITest {
            constructor() {
                this.currentQuestion = 0;
                this.answers = {};
                this.scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
                this.init();
            }

            init() {
                this.bindEvents();
                this.showWelcomeScreen();
            }

            bindEvents() {
                document.getElementById('startTestBtn').addEventListener('click', () => this.startTest());
                document.getElementById('nextBtn').addEventListener('click', () => this.nextQuestion());
            }

            showWelcomeScreen() {
                document.getElementById('questionText').textContent = 
                    "MBTI 성격 유형 테스트에 오신 것을 환영합니다! 8개의 간단한 질문으로 당신의 성격 유형을 알아보세요.";
                document.getElementById('answerOptions').innerHTML = '';
            }

            startTest() {
                document.getElementById('startTestBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';
                this.showQuestion();
            }

            showQuestion() {
                if (this.currentQuestion >= questions.length) {
                    this.completeTest();
                    return;
                }

                const question = questions[this.currentQuestion];
                this.updateQuestionDisplay(question);
                this.updateProgress();
                this.updateNavigationButtons();
            }

            updateQuestionDisplay(question) {
                document.getElementById('questionNumber').textContent = this.currentQuestion + 1;
                document.getElementById('questionText').textContent = question.text;
                
                const answerOptions = document.getElementById('answerOptions');
                answerOptions.innerHTML = '';
                
                question.options.forEach((option) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'answer-option';
                    optionElement.textContent = option.text;
                    
                    const previousAnswer = this.answers[question.id];
                    if (previousAnswer && previousAnswer.value === option.value) {
                        optionElement.classList.add('selected');
                    }
                    
                    optionElement.addEventListener('click', () => {
                        this.selectAnswer(question, option, optionElement);
                    });
                    
                    answerOptions.appendChild(optionElement);
                });
            }

            selectAnswer(question, option, element) {
                document.querySelectorAll('.answer-option').forEach(opt => opt.classList.remove('selected'));
                element.classList.add('selected');
                
                this.answers[question.id] = {
                    value: option.value,
                    dimension: question.dimension
                };
                
                document.getElementById('nextBtn').disabled = false;
            }

            nextQuestion() {
                this.currentQuestion++;
                this.showQuestion();
            }

            updateProgress() {
                const progress = ((this.currentQuestion + 1) / questions.length) * 100;
                document.getElementById('currentQuestion').textContent = this.currentQuestion + 1;
                document.getElementById('totalQuestions').textContent = questions.length;
                document.getElementById('progressPercentage').textContent = `${Math.round(progress)}%`;
                document.getElementById('progressFill').style.width = `${progress}%`;
            }

            updateNavigationButtons() {
                const nextBtn = document.getElementById('nextBtn');
                const currentAnswer = this.answers[questions[this.currentQuestion].id];
                nextBtn.disabled = !currentAnswer;
                
                if (this.currentQuestion === questions.length - 1) {
                    nextBtn.innerHTML = '완료 <i class="fas fa-check"></i>';
                } else {
                    nextBtn.innerHTML = '다음 <i class="fas fa-chevron-right"></i>';
                }
            }

            calculateScores() {
                this.scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
                Object.values(this.answers).forEach(answer => {
                    this.scores[answer.value]++;
                });
            }

            getMBTIType() {
                this.calculateScores();
                let type = '';
                type += this.scores.E >= this.scores.I ? 'E' : 'I';
                type += this.scores.S >= this.scores.N ? 'S' : 'N';
                type += this.scores.T >= this.scores.F ? 'T' : 'F';
                type += this.scores.J >= this.scores.P ? 'J' : 'P';
                return type;
            }

            completeTest() {
                const mbtiType = this.getMBTIType();
                document.getElementById('completionModal').classList.add('show');
                
                const testResult = {
                    type: mbtiType,
                    scores: this.scores,
                    answers: this.answers,
                    completedAt: new Date().toISOString()
                };
                
                localStorage.setItem('mbtiTestResult', JSON.stringify(testResult));

                setTimeout(() => {
                    document.getElementById('loadingSpinner').style.display = 'none';
                    const resultBtn = document.getElementById('viewResultBtn');
                    resultBtn.style.display = 'inline-block';
                    resultBtn.onclick = () => {
                        this.showResult(mbtiType, testResult);
                    };
                }, 2000);
            }

            showResult(mbtiType, testResult) {
                const modal = document.getElementById('completionModal');
                const modalContent = modal.querySelector('.modal-content-custom');
                
                modalContent.innerHTML = `
                    <h2 class="mb-3">🎉 테스트 완료!</h2>
                    <div class="result-display">
                        <h3 class="text-primary">${mbtiType}</h3>
                        <p class="lead">당신의 MBTI 성격 유형입니다!</p>
                        
                        <div class="mt-4 d-flex gap-2 flex-wrap justify-content-center">
                            <button class="btn btn-primary" onclick="location.href='types/${mbtiType.toLowerCase()}.html'">
                                <i class="fas fa-info-circle me-2"></i>상세 분석 보기
                            </button>
                            <button class="btn btn-success" onclick="shareResult()">
                                <i class="fas fa-share me-2"></i>결과 공유
                            </button>
                            <button class="btn btn-secondary" onclick="saveToGitHub()">
                                <i class="fab fa-github me-2"></i>GitHub에 저장
                            </button>
                            <button class="btn btn-outline-primary" onclick="location.reload()">
                                <i class="fas fa-redo me-2"></i>다시 테스트
                            </button>
                        </div>
                        
                        <div id="saveStatus" class="mt-3"></div>
                    </div>
                `;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new MBTITest();
        });

        // GitHub 연동 함수들
        async function saveToGitHub() {
            const saveStatus = document.getElementById('saveStatus');
            
            try {
                // GitHub API 설정 확인
                const settings = localStorage.getItem('github_api_settings');
                if (!settings) {
                    saveStatus.innerHTML = `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            GitHub API가 설정되지 않았습니다. 
                            <a href="github-settings.html" class="alert-link">설정 페이지</a>에서 먼저 설정해주세요.
                        </div>
                    `;
                    return;
                }

                saveStatus.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-spinner fa-spin me-2"></i>GitHub에 저장 중...
                    </div>
                `;

                const testResult = JSON.parse(localStorage.getItem('mbtiTestResult'));
                const githubSettings = JSON.parse(atob(settings));
                
                // GitHub Gist 생성
                const response = await fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${githubSettings.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        description: `MBTI 테스트 결과 - ${testResult.type}`,
                        public: false,
                        files: {
                            [`mbti-result-${testResult.type}-${new Date().toISOString().split('T')[0]}.md`]: {
                                content: `# MBTI 테스트 결과

## 분석 결과
- **유형**: ${testResult.type}
- **테스트 날짜**: ${new Date(testResult.completedAt).toLocaleString('ko-KR')}

## 상세 점수
${Object.entries(testResult.scores).map(([key, value]) => `- ${key}: ${value}점`).join('\n')}

## 답변 내역
${Object.entries(testResult.answers).map(([key, value]) => `**문항 ${key}**: ${value.text || value.value}`).join('\n')}

---
*이 결과는 MBTI 분석 사이트에서 자동 생성되었습니다.*
`
                            }
                        }
                    })
                });

                if (response.ok) {
                    const gist = await response.json();
                    saveStatus.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>
                            GitHub에 성공적으로 저장되었습니다!
                            <a href="${gist.html_url}" target="_blank" class="alert-link ms-2">
                                <i class="fas fa-external-link-alt"></i> 확인하기
                            </a>
                        </div>
                    `;
                } else {
                    throw new Error('GitHub 저장 실패');
                }
            } catch (error) {
                saveStatus.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-times-circle me-2"></i>
                        저장 실패: ${error.message}
                    </div>
                `;
            }
        }

        function shareResult() {
            const testResult = JSON.parse(localStorage.getItem('mbtiTestResult'));
            const shareText = `MBTI 테스트 결과: ${testResult.type}\n\n나의 성격 유형을 발견했어요! 당신도 테스트해보세요.\n\n${window.location.origin}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'MBTI 테스트 결과',
                    text: shareText,
                    url: window.location.origin
                });
            } else {
                navigator.clipboard.writeText(shareText)
                    .then(() => alert('결과가 클립보드에 복사되었습니다!'))
                    .catch(() => alert('공유 기능을 사용할 수 없습니다.'));
            }
        }
    </script>
</body>
</html>